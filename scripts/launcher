#!/bin/bash
PRIMARY="#458588"
BG="#1d2021"
FG="#ebdbb2"
APP=$(find /usr/share/applications -name '*.desktop' \
    | while IFS= read -r f; do
        grep -qi '^NoDisplay=true' "$f" && continue
        NAME=$(grep -m1 '^Name=' "$f" | sed 's/^Name=//')
        [ -n "$NAME" ] && echo "$NAME"
    done | sort -f | wmenu -p "Application: " -i -N $BG -n $FG -m $BG -s $FG -S $PRIMARY -s $BG -M $PRIMARY)

if [ -n "$APP" ]; then
    find /usr/share/applications -name "*.desktop" | while IFS= read -r f; do
        NAME=$(grep -m1 '^Name=' "$f" | sed 's/^Name=//')
        if [ "$NAME" = "$APP" ]; then
            CMD=$(grep -m1 '^Exec=' "$f" | sed -E 's/^Exec=//; s/ *%[a-zA-Z]//g')
            "$CMD" &
            break
        fi
    done
fi
